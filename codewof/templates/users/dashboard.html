{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block page_heading %}
    <h1 class="display-3 orange-underline text-center">
        Kia ora {{ user.first_name }}!
    </h1>
{% endblock page_heading %}

{% block content_container %}
    {% comment %} Left column {% endcomment %}
    <div class="col-12 col-md-8 mb-3">
        {% comment %} Conditional here to check if allowed to use website {% endcomment %}
        <h2>Your recommended questions</h2>
        <p>We recommend doing one or two questions per day, to maintain your programming skills over a long period of time.</p>

        <div id="recommendations" class="row">
            <div class="col-12 col-md-6">
                <div class="recommendation-border">
                    <div class="recommendation">
                        <p>
                            <strong>Want to maintain your skills?</strong>
                            <br>
                            This question is likely to be at a difficulty you are accustomed to,
                            while utilising a wide range of programming concepts and question contexts.
                        </p>
                        <div id="question-1">
                            <br>
                            <div class="d-flex justify-content-center">
                                <div class="spinner-border" role="status">
                                    <span class="sr-only">Loading...</span>
                                </div>
                            </div>
                            <br><br>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-6">
                <div class="recommendation-border">
                    <div class="recommendation">
                        <p>
                            <strong>Are you up for a challenge?</strong>
                            <br>
                            This question is at a higher difficulty level than what you are comfortable with,
                            while making use of some concepts and contexts you are well versed in.
                        </p>
                        <div id="question-2">
                            <br>
                            <div class="d-flex justify-content-center">
                                <div class="spinner-border" role="status">
                                    <span class="sr-only">Loading...</span>
                                </div>
                            </div>
                            <br><br>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <br>
        <p>You've solved {{ num_questions_answered }} question{{ num_questions_answered|pluralize }} in the last month!</p>

        <h2>Groups</h2>
        {% if memberships %}
            {% for membership in memberships %}
                {% include "users/group-card.html" %}
            {% endfor %}
        {% else %}
            <p>You are not in any groups.</p>
        {% endif %}

        <a class="btn btn-primary btn-sm" href="{% url 'users:groups-add' %}">Create Group</a>
    </div>

    {% comment %} Right column {% endcomment %}
    <div class="col-12 col-md-4 mb-3">
        <h2>Points earned: {{ user.profile.points }}</h2>

        <h2>Achievements</h2>
        <div class="mb-3">
            {% for achievement in all_achievements %}
                {% if achievement in user.profile.earned_achievements.all and achievement.parent not in user.profile.earned_achievements.all %}
                    <div class="achievement-container">
                        <a class="achievements-link" href="{% url 'users:achievements' %}">
                            <img class="achievement-icon" src="{% static achievement.icon_name %}">
                            <b>{{ achievement.display_name }}</b>
                        </a>
                    </div>
                {% endif %}
            {% endfor %}
        </div>

        <div id="invitations-div" class=" mb-3">
            <h2>Invitations</h2>
                {% if invitations %}
                    {% for invitation in invitations %}
                        {% include "users/invitation-card.html" %}
                {% endfor %}
            {% else %}
                <p>You have no invitations.</p>
            {% endif %}
        </div>

        <div class="mb-3">
            <h2>Settings</h2>
            <div class="list-group">
                <a href="{% url 'users:update' %}" class="list-group-item list-group-item-action">
                    Manage your profile
                </a>
            {% if user.is_staff %}
                <a href="{% url 'admin:index' %}" class="list-group-item list-group-item-action">
                    Open admin website
                </a>
            {% endif %}
            </div>
        </div>
    </div>
{% endblock content_container %}

{% block css %}
    {{ block.super }}
    <link href="{% static 'css/invitations.css' %}" rel="stylesheet">
{% endblock css %}

{% block scripts %}
{{ block.super }}
{% csrf_token %}
<script>
const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
function getAcceptURL(invitationID) {
  return `{% url 'users:groups-invitations-accept' 0 %}`.replace("0", invitationID);
}
function getRejectURL(invitationID) {
  return `{% url 'users:groups-invitations-reject' 0 %}`.replace("0", invitationID);
}
function getRecommendedQuestionsURL() {
    return `{% url 'users:recommended-questions' %}`;
}
</script>

<script src="{% static 'js/groups/invitations.js' %}"></script>
<script src="{% static 'js/question_recommendations/recommended_questions.js' %}"></script>
{% endblock scripts %}
